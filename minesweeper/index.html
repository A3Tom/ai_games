<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .inset-shadow {
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons (simplified inline SVG versions)
        const Flag = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                <line x1="4" y1="22" x2="4" y2="15"></line>
            </svg>
        );

        const Bomb = ({ size = 18, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="8"></circle>
                <line x1="12" y1="2" x2="12" y2="4"></line>
                <line x1="12" y1="20" x2="12" y2="22"></line>
                <line x1="4.93" y1="4.93" x2="6.34" y2="6.34"></line>
                <line x1="17.66" y1="17.66" x2="19.07" y2="19.07"></line>
                <line x1="2" y1="12" x2="4" y2="12"></line>
                <line x1="20" y1="12" x2="22" y2="12"></line>
                <line x1="4.93" y1="19.07" x2="6.34" y2="17.66"></line>
                <line x1="17.66" y1="6.34" x2="19.07" y2="4.93"></line>
            </svg>
        );

        const Trophy = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                <path d="M4 22h16"></path>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
        );

        const Skull = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="9" cy="12" r="1"></circle>
                <circle cx="15" cy="12" r="1"></circle>
                <path d="M8 20v2h8v-2"></path>
                <path d="M12.5 17H11"></path>
                <path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"></path>
            </svg>
        );

        // Constants
        const DIFFICULTIES = {
            Beginner: { rows: 9, cols: 9, mines: 10 },
            Intermediate: { rows: 16, cols: 16, mines: 40 },
            Expert: { rows: 16, cols: 30, mines: 99 },
        };

        const NUMBER_COLORS = [
            '',
            'text-blue-600',
            'text-green-600',
            'text-red-600',
            'text-indigo-800',
            'text-red-900',
            'text-teal-600',
            'text-black',
            'text-gray-600'
        ];

        const OFFSETS = [
            [-1, -1], [-1, 0], [-1, 1],
            [0, -1],           [0, 1],
            [1, -1],  [1, 0],  [1, 1]
        ];

        // Helper Functions
        const createEmptyBoard = (rows, cols) => {
            const board = [];
            for (let y = 0; y < rows; y++) {
                const row = [];
                for (let x = 0; x < cols; x++) {
                    row.push({
                        x, y,
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        neighborCount: 0
                    });
                }
                board.push(row);
            }
            return board;
        };

        const placeMines = (board, rows, cols, mines, safeX, safeY) => {
            let minesPlaced = 0;
            while (minesPlaced < mines) {
                const x = Math.floor(Math.random() * cols);
                const y = Math.floor(Math.random() * rows);

                if (!board[y][x].isMine && (x !== safeX || y !== safeY)) {
                    board[y][x].isMine = true;
                    minesPlaced++;
                }
            }

            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    if (!board[y][x].isMine) {
                        let count = 0;
                        OFFSETS.forEach(([dy, dx]) => {
                            const ny = y + dy;
                            const nx = x + dx;
                            if (ny >= 0 && ny < rows && nx >= 0 && nx < cols && board[ny][nx].isMine) {
                                count++;
                            }
                        });
                        board[y][x].neighborCount = count;
                    }
                }
            }
            return board;
        };

        // Cell Component
        const Cell = ({ cell, onClick, onRightClick }) => {
            const { isRevealed, isFlagged, isMine, neighborCount } = cell;

            let cellStyle = "w-8 h-8 flex items-center justify-center text-sm font-bold select-none cursor-pointer border ";
            
            if (!isRevealed) {
                cellStyle += "bg-slate-300 border-t-slate-100 border-l-slate-100 border-b-slate-500 border-r-slate-500 hover:bg-slate-200";
            } else {
                cellStyle += "bg-slate-200 border-slate-300 ";
                if (isMine) {
                    cellStyle += "bg-red-500 border-none";
                }
            }

            const renderContent = () => {
                if (isFlagged) {
                    return <Flag size={16} className="text-red-600 fill-red-600" />;
                }
                if (!isRevealed) return null;
                
                if (isMine) {
                    return <Bomb size={18} className="text-black fill-black/50" />;
                }
                
                if (neighborCount > 0) {
                    return <span className={NUMBER_COLORS[neighborCount]}>{neighborCount}</span>;
                }
                return null;
            };

            return (
                <div 
                    className={cellStyle}
                    onClick={onClick}
                    onContextMenu={onRightClick}
                    role="button"
                >
                    {renderContent()}
                </div>
            );
        };

        // Main Minesweeper Component
        function Minesweeper() {
            const [difficulty, setDifficulty] = useState('Beginner');
            const [board, setBoard] = useState([]);
            const [gameState, setGameState] = useState('idle');
            const [mineCount, setMineCount] = useState(0);
            const [flagCount, setFlagCount] = useState(0);
            const [time, setTime] = useState(0);

            useEffect(() => {
                resetGame();
            }, [difficulty]);

            useEffect(() => {
                let interval;
                if (gameState === 'playing') {
                    interval = setInterval(() => {
                        setTime(prev => Math.min(prev + 1, 999));
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [gameState]);

            const resetGame = () => {
                const { rows, cols, mines } = DIFFICULTIES[difficulty];
                setBoard(createEmptyBoard(rows, cols));
                setGameState('idle');
                setMineCount(mines);
                setFlagCount(0);
                setTime(0);
            };

            const revealCell = (board, x, y, rows, cols) => {
                if (x < 0 || x >= cols || y < 0 || y >= rows || board[y][x].isRevealed || board[y][x].isFlagged) {
                    return;
                }

                board[y][x].isRevealed = true;

                if (board[y][x].neighborCount === 0) {
                    OFFSETS.forEach(([dy, dx]) => {
                        revealCell(board, x + dx, y + dy, rows, cols);
                    });
                }
            };

            const revealAllMines = (board) => {
                board.forEach(row => {
                    row.forEach(cell => {
                        if (cell.isMine) cell.isRevealed = true;
                    });
                });
            };

            const flagAllMines = (board) => {
                board.forEach(row => {
                    row.forEach(cell => {
                        if (cell.isMine) cell.isFlagged = true;
                    });
                });
                setFlagCount(mineCount);
            };

            const checkWin = (board) => {
                const { rows, cols, mines } = DIFFICULTIES[difficulty];
                let revealedCount = 0;
                board.forEach(row => {
                    row.forEach(cell => {
                        if (cell.isRevealed) revealedCount++;
                    });
                });
                return revealedCount === (rows * cols - mines);
            };

            const handleCellClick = (x, y) => {
                if (gameState === 'won' || gameState === 'lost') return;
                if (board[y][x].isFlagged) return;

                let newBoard = [...board.map(row => [...row])];
                const { rows, cols, mines } = DIFFICULTIES[difficulty];

                if (gameState === 'idle') {
                    setGameState('playing');
                    newBoard = placeMines(newBoard, rows, cols, mines, x, y);
                }

                if (newBoard[y][x].isMine) {
                    revealAllMines(newBoard);
                    setGameState('lost');
                    setBoard(newBoard);
                    return;
                }

                revealCell(newBoard, x, y, rows, cols);
                
                if (checkWin(newBoard)) {
                    setGameState('won');
                    flagAllMines(newBoard);
                }
                
                setBoard(newBoard);
            };

            const handleRightClick = (e, x, y) => {
                e.preventDefault();
                if (gameState === 'won' || gameState === 'lost') return;
                if (board[y][x].isRevealed) return;

                const newBoard = [...board.map(row => [...row])];
                const cell = newBoard[y][x];

                if (!cell.isFlagged && flagCount < mineCount) {
                    cell.isFlagged = true;
                    setFlagCount(prev => prev + 1);
                } else if (cell.isFlagged) {
                    cell.isFlagged = false;
                    setFlagCount(prev => prev - 1);
                }
                
                setBoard(newBoard);
            };

            const getSmiley = () => {
                if (gameState === 'won') return <Trophy size={24} className="text-yellow-600" />;
                if (gameState === 'lost') return <Skull size={24} className="text-gray-700" />;
                return <div className="text-yellow-500 font-bold text-xl">:)</div>;
            };

            return (
                <div className="min-h-screen bg-slate-100 flex flex-col items-center justify-center p-4 font-sans text-slate-900">
                    
                    <div className="mb-6 flex gap-4 bg-white p-2 rounded-lg shadow-sm">
                        {Object.keys(DIFFICULTIES).map(diff => (
                            <button
                                key={diff}
                                onClick={() => setDifficulty(diff)}
                                className={`px-4 py-1 rounded-md text-sm font-semibold transition-colors
                                    ${difficulty === diff 
                                        ? 'bg-blue-600 text-white shadow-md' 
                                        : 'text-slate-600 hover:bg-slate-100'}`}
                            >
                                {diff}
                            </button>
                        ))}
                    </div>

                    <div className="bg-slate-300 p-4 rounded-lg shadow-[0_20px_25px_-5px_rgba(0,0,0,0.1),0_10px_10px_-5px_rgba(0,0,0,0.04)] border-t-4 border-l-4 border-white border-b-4 border-r-4 border-slate-400 select-none">
                        
                        <div className="flex justify-between items-center bg-slate-200 border-4 border-b-white border-r-white border-t-slate-400 border-l-slate-400 p-2 mb-4 inset-shadow">
                            
                            <div className="bg-black px-2 py-1 text-red-600 font-mono text-3xl leading-none border-2 border-slate-400 border-b-white border-r-white w-20 text-center">
                                {String(mineCount - flagCount).padStart(3, '0')}
                            </div>

                            <button 
                                onClick={resetGame}
                                className="w-12 h-12 flex items-center justify-center bg-slate-300 border-4 border-white border-b-slate-500 border-r-slate-500 active:border-slate-500 active:border-b-white active:border-r-white active:bg-slate-200"
                            >
                                {getSmiley()}
                            </button>

                            <div className="bg-black px-2 py-1 text-red-600 font-mono text-3xl leading-none border-2 border-slate-400 border-b-white border-r-white w-20 text-center">
                                {String(time).padStart(3, '0')}
                            </div>
                        </div>

                        <div className="border-4 border-slate-400 border-b-white border-r-white relative">
                            <div 
                                className="grid bg-slate-400 gap-[1px]"
                                style={{ 
                                    gridTemplateColumns: `repeat(${DIFFICULTIES[difficulty].cols}, min-content)` 
                                }}
                            >
                                {board.map((row, y) => (
                                    row.map((cell, x) => (
                                        <Cell 
                                            key={`${x}-${y}`} 
                                            cell={cell}
                                            onClick={() => handleCellClick(x, y)}
                                            onRightClick={(e) => handleRightClick(e, x, y)}
                                        />
                                    ))
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="mt-8 text-slate-500 text-sm max-w-md text-center">
                        <p><strong>Left Click</strong> to reveal. <strong>Right Click</strong> to flag.</p>
                        <p className="mt-1">First click is always safe.</p>
                    </div>

                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Minesweeper />);
    </script>
</body>
</html>